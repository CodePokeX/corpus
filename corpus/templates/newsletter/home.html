{% extends 'newsletter/base.html' %}
{% load static %}

{% block title %}
    Newsletter
{% endblock %}
{% block content %}

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .post-bar:hover {
        transform: scale(1.05);
        transition: transform 0.3s ease;
    }

    .post-bar {
        transition: transform 0.3s ease;
    }

    .carousel {
        scroll-behavior: smooth;
    }

</style>

{% include 'newsletter/header.html' %}
{% if is_admin %}
<div class="flex justify-center">
    <a href="{% url 'newsletter_manage_announcements' %}" class="btn btn-primary text-center m-6">Manage Announcements</a>
</div>
{% endif %}
<div class="flex flex-col lg:flex-row justify-center gap-0">
    <!-- What's New Section -->
    <section class="bg-base-300 my-10 px-5 md:px-10 shadow-xl w-full lg:w-1/2">
        <h1 class="text-center my-10 text-2xl md:text-4xl lg:text-5xl">What's New?</h1>
        <div class="m-5 md:m-10 p-5 md:p-10 overflow-y-auto scrollbar-hide">
            {% for announcement in announcements %}
            <a href="{{ announcement.link }}"
                class="mb-4 post-bar indicator py-5 md:py-10 px-5 md:px-10 w-full border border-blue-300 
                rounded-lg block bg-gradient-to-r dark:from-blue-400 dark:to-primary-500 dark:text-white
                from-purple-400 to-blue-500 text-white">
                {% if forloop.counter is 1 %}
                    <span class="indicator-item badge badge-accent">new</span>
                {% endif %}
                <h2 class="text-center text-xl md:text-2xl lg:text-3xl w-full">{{ announcement.title }}</h2>
                <p class="mt-4 text-md text-right md:text-xl lg:text-xl">
                    {% if announcement.start_date and announcement.end_date %}
                        {{ announcement.start_date }} - {{ announcement.end_date }}</p>
                    {% elif announcement.start_date %}
                        {{ announcement.start_date }}
                    {% elif announcement.end_date %}
                        {{ announcement.end_date }}
                    {% else %}
                        Coming Soon
                    {% endif %}
                </p>
            </a>
            {% endfor %}
        </div>
    </section>

    <div class="divider divider-accent dark:divider-secondary text-pink-500 dark:text-blue-500 divider-horizontal"></div>

    <section class="bg-base-300 my-10 px-5 md:px-10 shadow-xl w-full lg:w-1/2">
        <h1 class="my-10 text-center text-2xl md:text-4xl lg:text-5xl">Recent Events</h1>
        <div class="relative w-full mx-auto">
            <div class="carousel rounded-lg overflow-hidden relative mb-10" id="carousel">
                {% for event in events %}
                <div id="slide{{ forloop.counter }}" class="carousel-item relative w-full">
                    {% if event.image %}
                        <img src="{{ event.image.url }}"
                    {% else %}
                        <img src="{% static "img/newsletter/default.jpg" %}"
                    {% endif %}
                         class="object-cover w-[1400px] h-[700px] mx-auto" />
                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                        <h1 class="text-4xl text-white text-center">{{ event.title }} - {{ event.date }}</h1>
                    </div>
                </div>
                {% endfor %}
                <button id="prevButton" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white px-3 py-2 rounded-l-lg z-10">
                    ❮
                </button>
                <button id="nextButton" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white px-3 py-2 rounded-r-lg z-10">
                    ❯
                </button>
            </div>
        </div>
    </section>
    
</div>
{% endblock %}
{% block script %}
<script>
    const carousel = document.getElementById("carousel");
    const slides = carousel.getElementsByClassName("carousel-item");
    const prevButton = document.getElementById("prevButton");
    const nextButton = document.getElementById("nextButton");

    let currentSlide = 0;

    const showSlide = (index) => {
      Array.from(slides).forEach((slide, i) => {
        slide.classList.toggle("hidden", i !== index);
        slide.classList.toggle("block", i === index);
      });
    };

    const nextSlide = () => {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    };

    const prevSlide = () => {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(currentSlide);
    };

    nextButton.addEventListener("click", nextSlide);
    prevButton.addEventListener("click", prevSlide);

    // Auto Slide Logic
    setInterval(nextSlide, 3000); // Change slide every 3 seconds

    // Initialize
    showSlide(currentSlide);
</script>

{% endblock %}
